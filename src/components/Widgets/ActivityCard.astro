---
import type { ActivityItem } from '@/utils/github-activity'
import { getRelativeTime } from '@/utils/time-simple'

interface Props {
  activity: ActivityItem
}

const { activity } = Astro.props

const timeAgo = getRelativeTime(activity.created_at)

const icons = {
  PushEvent: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M16 2a3 3 0 0 1 2.83 2H21v2h-2.17a3.001 3.001 0 0 1-5.66 0H11v5.17a3.001 3.001 0 0 1 0 5.66V19h2.17a3.001 3.001 0 0 1 5.66 0H21v2h-2.17a3 3 0 0 1-5.66 0H11v1a1 1 0 0 1-2 0v-1H6.83a3 3 0 0 1-5.66 0H0v-2h1.17a3.001 3.001 0 0 1 5.66 0H9V9.17a3.001 3.001 0 0 1 0-5.66V2h2.17A3.001 3.001 0 0 1 16 2z"/></svg>`,
  WatchEvent: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`,
  PullRequestEvent: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M15 5h2a2 2 0 0 1 2 2v8.17a3.001 3.001 0 0 1 2.83 2H24v2h-2.17a3.001 3.001 0 0 1-5.66 0H14v-1a1 1 0 0 1-2 0V7a1 1 0 0 1 2-0zm-9 9H3.83a3.001 3.001 0 0 1-2.66-2V2h2.17a3.001 3.001 0 0 1 5.32 0H11v10a1 1 0 0 1-2 0v2h2.17a3.001 3.001 0 0 1 2.66 2H16v2h-2.17a3.001 3.001 0 0 1-5.66 0H6v-2h2.17a3.001 3.001 0 0 1 2.66-2H6z"/></svg>`,
  CreateEvent: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>`,
  ReleaseEvent: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M12.89 3l1.43 1.41L7.91 10.82l6.41 6.41 6.41-6.41-6.41-6.41 1.41-1.41 6.41 6.41c.78.78.78 2.05 0 2.83l-6.41 6.41c-.78.78-2.05.78-2.83 0l-6.41-6.41c-.78-.78-.78-2.05 0-2.83L12.89 3zM6.5 12a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/></svg>`,
  BlogPost: `<svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`,
}

const actionText = {
  PushEvent: 'pushed to',
  WatchEvent: 'starred',
  PullRequestEvent: 'opened PR in',
  CreateEvent: 'created',
  ReleaseEvent: 'released',
  BlogPost: 'published',
}

const icon = icons[activity.type] || icons.CreateEvent
const action = actionText[activity.type] || 'acted on'
const isInternal = activity.type === 'BlogPost'
---

<div class="group activity-item relative flex gap-3" data-type={activity.type === 'BlogPost' ? 'blog' : 'github'}>
  <!-- Timeline line -->
  <div class="absolute bottom--2 left-2 top-6 w-px bg-secondary/20 group-last:hidden"></div>

  <!-- Icon -->
  <div class="relative z-10 mt-1 h-4 w-4 flex-shrink-0 text-secondary/60 transition-colors group-hover:text-primary" set:html={icon} />

  <!-- Content -->
  <div class="min-w-0 flex-1 pb-4 text-3.5 leading-snug">
    <div class="text-secondary/80">
      <span class="text-secondary/60">{action}</span>
      <a
        href={activity.repo.url}
        target={isInternal ? '_self' : '_blank'}
        rel="noopener noreferrer"
        class="inline-block max-w-full truncate align-bottom text-primary font-medium hover:underline"
      >
        {activity.repo.name}
      </a>
    </div>
    <div class="mt-0.5 text-3 text-secondary/40 font-time">
      {timeAgo}
    </div>
  </div>
</div>
