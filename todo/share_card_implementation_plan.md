# 分享卡片功能实现计划

## 1. 目标
实现一个个性化的风格分享功能。用户可以将整篇文章摘要或选中的特定段落，生成一张精美的图片进行分享。
参考风格：玻璃拟态、高质感背景、清晰的排版、包含url和 简要的信息。

## 2. 技术选型
- **核心生成库**: `html-to-image` (将 DOM 转换为图片)
- **下载处理**: `downloadjs` (处理图片下载)
- **二维码生成**: `qrcode` (可选，用于生成文章链接二维码)
- **UI 框架**: 现有项目架构 (Astro + UnoCSS/Tailwind)

## 3. 核心组件架构

### A. `ShareCard.astro` (模版组件)
这是用于“截图”的幕后组件。
- **状态**: 平时隐藏 (fixed off-screen) 或仅在内存中渲染。
- **结构**:
  - 背景：高质量渐变
  - 容器：玻璃拟态卡片 (Frosted Glass)。
  - 内容区：
    - 标题：文章标题。
    - 正文：用户选中的文字 或 文章摘要。
    - 底部：作者信息、日期、原文链接。

### B. `ShareModal.astro` (交互组件)
这是用户可以见到的弹窗。
- **触发方式**: 点击文章底部的“分享”按钮，或划词后点击浮动的“引用分享”按钮。
- **结构**:
  - 全屏半透明遮罩。
  - 中间显示已生成的图片预览 (`<img>` 标签，src 为 base64)。
  - 底部操作栏：
    - [下载图片] 按钮。
    - [复制图片] 按钮 (支持 Clipboard API)。
    - [关闭] 按钮。

### C. 全局交互脚本
- **划词监听**: 监听 `mouseup` 事件，判断是否有文本被选中。
- **浮动按钮**: 在选中文字附近显示“生成卡片”小按钮。
- **生成逻辑**:
  1. 获取数据 (标题、选中文本/摘要、URL)。
  2. 将数据注入到 `ShareCard` 组件 DOM 中。
  3. 调用 `html-to-image` 生成 PNG。
  4. 打开 `ShareModal` 并展示 result。

## 4. 实施步骤

- [ ] **Step 1: 依赖安装**
  - 安装 `html-to-image`, `downloadjs`, `qrcode`。

- [ ] **Step 2: 创建 ShareCard 组件**
  - 编写 HTML/CSS 结构。
  - 使用 UnoCSS 实现玻璃拟态 (`backdrop-filter`) 和渐变效果。
  - 确保字体加载和排版在截图时保持一致 (处理 CSS 加载延迟问题)。

- [ ] **Step 3: 创建 ShareModal 组件**
  - 实现基础弹窗 UI。
  - 编写关闭和展示预览图的逻辑。

- [ ] **Step 4: 实现核心生成逻辑**
  - 编写工具函数 `generateCardImage(text, title, author)`。
  - 解决常见的截图坑 (如图片跨域、字体闪烁、Safari 兼容性)。

- [ ] **Step 5: 集成划词功能 (Text Selection)**
  - 实现一个简单的 `FloatingAction` 组件。
  - 当用户在文章区域选中文本时显示。

- [ ] **Step 6: 这里是入口整合**
  - 在 `PostLayout` 或 `Layout` 中引入上述组件。
  - 绑定文章底部的固定分享按钮。

## 5. 待确认细节
- 是否需要支持黑暗模式/明亮模式的卡片切换？(默认建议设计一套通用的深色高级感模版)
- 图片尺寸比例？(建议 3:4 或 9:16 适合手机分享)
